<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper
        PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
        "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.app.mapper.UserHealthMapper">
    <!-- 用户健康表插入数据   -->
    <insert id="insertData1" >
        INSERT INTO UserHealth(
            openId,
            userName,
            createTime,
            nowAddress,
            longitude,
            latitude
        ) VALUES(
            #{openId},
            #{userName},
            #{createTime},
            #{nowAddress},
            #{longitude},
            #{latitude}
        );
    </insert>

    <!--  用户请假表插入数据  -->
    <insert id="insertData2" >
        INSERT INTO UserLeave(
            openId,
            userName,
            createTime,
            leaveType,
            leaveCase,
            startTime,
            endTime
        ) VALUES
        <foreach collection="list" index="index" item="item" separator=",">
            (
            #{item.openId},
            #{item.userName},
            #{item.createTime},
            #{item.leaveType},
            #{item.leaveCase},
            #{item.startTime},
            #{item.endTime}
            )
        </foreach>
    </insert>

    <select id="GetName" resultType="com.app.bean.UserHealth">
        SELECT * FROM userHealth WHERE UserName=#{user_name};
    </select>

    <!-- 新增药品 -->
    <insert id="insertDrug">
        INSERT INTO UserDrug(
            openId,
            userName,
            createTime,
            drugUuid,
            eatTime,
            drugName,
            eatMorning,
            eatNoon,
            eatNight,
            eatDays,
            eatMorningNum,
            eatNoonNum,
            eatNightNum,
            timeMorning,
            timeNoon,
            timeNight,
            drugPrice,
            manufacturer,
            detail
        ) VALUES(
            #{openId},
            #{userName},
            #{createTime},
            #{drugUuid},
            #{eatTime},
            #{drugName},
            #{eatMorning},
            #{eatNoon},
            #{eatNight},
            #{eatDays},
            #{eatMorningNum},
            #{eatNoonNum},
            #{eatNightNum},
            #{timeMorning},
            #{timeNoon},
            #{timeNight},
            #{drugPrice},
            #{manufacturer},
            #{detail}
        );
    </insert>

    <insert id="insertFood">
        INSERT INTO UserFood(
            userName,
            createTime,
            foodName,
            foodCalorie,
            foodProbability,
            openId
        ) values(
            #{userName},
            #{createTime},
            #{foodName},
            #{foodCalorie},
            #{foodProbability},
            #{openId}
        );
    </insert>

    <select id="queryDrug" resultType="com.app.bean.UserDrugResult">
            select t1.*,t2.subscriptionStatus from UserDrug t1 LEFT JOIN UserDrugSubscription t2 ON t1.openId  = t2.openId and t1.drugUuid = t2.drugUuid WHERE t1.openId = #{openId} limit #{start},#{rows};
    </select>

    <select id="drugNum" resultType="integer">
        select count(1) from UserDrug WHERE openId = #{openId};
    </select>

    <select id="queryDrugId" resultType="com.app.bean.UserDrug">
        select openId,
               userName,
               createTime,
               drugUuid,
               eatTime,
               drugName,
               eatMorning,
               eatNoon,
               eatNight,
               eatDays,
               eatMorningNum,
               eatNoonNum,
               eatNightNum,
               timeMorning,
               timeNoon,
               timeNight,
               drugPrice,
               manufacturer,
               detail
        from UserDrug t1
        WHERE openId = #{openId}
          and drugUuid = #{drugUuid}
    </select>
</mapper>